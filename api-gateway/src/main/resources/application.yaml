server:
  port: 8080
  forward-headers-strategy: framework

spring:
  application:
    name: api-gateway
  # --- Gateway Routing Configuration ---
  main:
    web-application-type: reactive
  cloud:
    gateway:
      forwarded:
        enabled: true
      routes:
        # Route to the Authentication Service
        - id: swagger-auth
          uri: ${AUTH_URL:http://localhost:8081}
          predicates:
            - Path=/swagger/auth/**
          filters:
            - RewritePath=/swagger/auth/(?<segment>.*), /${segment}
            - AuthenticationFilter

        # Route to the Matching Service
        - id: swagger-matching
          uri: ${MATCHING_URL:http://localhost:8082}
          predicates:
            - Path=/swagger/matching/**
          filters:
            - RewritePath=/swagger/matching/(?<segment>.*), /${segment}
            - AuthenticationFilter

        # Route to Notification Service
        - id: swagger-notification
          uri: ${NOTIFICATION_URL:http://localhost:8083}
          predicates:
            - Path=/swagger/notification/**
          filters:
            - RewritePath=/swagger/notification/(?<segment>.*), /${segment}
            - AuthenticationFilter

springdoc:
  swagger-ui:
    urls:
      - name: Auth API
        url: /swagger/auth/v3/api-docs
      - name: Matching API
        url: /swagger/matching/v3/api-docs
      - name: Notification API
        url: /swagger/notification/v3/api-docs

  api-docs:
    path: /v3/api-docs
    groups:
      enabled: true

# --- Actuator Health Endpoint Configuration ---
management:
  endpoints:
    web:
      exposure:
        include: "health,info,gateway"
  endpoint:
    health:
      show-details: always
      probes:
        enabled: true
    gateway:
      enabled: true

logging:
  level:
    # This logs the final routing decision for each request.
    org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator: INFO
    # This is the most useful logger. It shows how a request is matched against predicates.
    org.springframework.cloud.gateway.handler.predicate: DEBUG
    # This logs which global filters are being applied.
    org.springframework.cloud.gateway.filter: DEBUG
    # For extremely verbose logging, including headers and bodies, change this to TRACE
    org.springframework.cloud.gateway: TRACE

# --- Custom Application Properties ---
app:
  clients:
    # URL to fetch the public key for JWT validation
    auth-public-key-url: ${AUTH_PUBLIC_KEY_URL:http://localhost:8081/api/auth/public-key}